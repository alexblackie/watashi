#!/usr/bin/env bash

# Deploys to Github Pages by using git-subtree to push the build folder to the
# magic Github branch. This requires the entire built site to be tracked in Git
# which is gross and I hate it, but it works.

set -euf -o pipefail

# Use subtree to generate a branch with just the contents of _build
git subtree split --prefix _build -b gh-pages

# Just yeet it up there
git push --force-with-lease origin gh-pages:gh-pages

# We need to clean up the local branch otherwise it will complain that the
# commits are not ancestors on subsequent builds.
git branch -D gh-pages
